{{ define "planning2" }}
    <script>
    	var planningInfo = {{.PlanningInfo}}
    	var url = new URL(window.location.href);
    	var platform = url.searchParams.get("platform");
    	if (platform == "") {
    		platform = null
    	}
    	var team = url.searchParams.get("team");
    	if (team == "") {
    		team = null
    	}
    </script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="assets/js/planning2/theme.min.css">

	<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js'></script>
	<script src='https://code.highcharts.com/highcharts.js'></script>
    <script src="assets/js/libs/jquery.query-object.js"></script>
	<script src="assets/js/themes/theme.js"></script>
    <script src="assets/js/planning2/bar.js"></script>
    <script src="assets/js/planning2/chart.js"></script>
    <script src="assets/js/planning2/issues.js"></script>

    <script>
    	var plannedIssues = [];
    	var lostIssues = [];
    	if (platform == null) {
    		for(var key in planningInfo.platforms) {
    			var platformData = planningInfo.platforms[key]
	          	plannedIssues = plannedIssues.concat(platformData.plannedIssues)
	          	lostIssues = lostIssues.concat(platformData.lostIssues)
			}
    	} else {
    		plannedIssues = planningInfo.platforms[platform].plannedIssues
    		lostIssues = planningInfo.platforms[platform].lostIssues
    	}
    	plannedIssues = Issues.filter(plannedIssues)
    	lostIssues = Issues.filter(lostIssues)
    </script>

	<div class="container">

		<div class="bs-docs-section">
			<div class="row" style="margin-top: 2rem;">
				<div class="col-lg-12">
					<div class="bs-component">
						
						<div id="bar" style="height: 200px;margin-top: 0rem;"></div>

						<div class="page-header" style="margin-top: 1rem;">
					    	<h5>Platforms:</h5>
						</div>
						
						<div id="chart" style="height: 400px;margin-top: -3rem;"></div>

						<div class="page-header" style="top: 0px; position: absolute; width: 100%">
							<script>
					    		document.write(`
								    	<h1>` + team + `</h1>
				    			`)
							</script>

							<button id="refresh-button" type="button" class="btn btn-primary" style="position: absolute; right: 50px; top: 5px;">
								Refresh 
							</button>
						</div>		

					</div>	
				</div>
			</div>
		</div>

		<div class="bs-docs-section" id="content">
	        <div class="row" style="margin-bottom: 2rem;">
	          	<div class="col-lg-12">
	          		<div class="bs-component">
				    	<script>
				    		if (plannedIssues.length > 0) {
					    		document.write(`
									<div class="page-header" style="margin-top: 3rem;">
								    	<h5>Planned Issues:</h5>
									</div>
				    			`)
					    		Issues.draw(plannedIssues)
					    	}

				    		if (lostIssues.length > 0) {
					    		document.write(`
									<div class="page-header" style="margin-top: 3rem;">
								    	<h5>Lost Issues:</h5>
									</div>
				    			`)
					    		Issues.draw(lostIssues)
					    	}

					    	if (plannedIssues.length <= 0 && lostIssues.length <= 0) {
					    		document.write(`
									<div style="margin-top: 3rem;">
							    		<p class="lead" align="center">Здесь могла быть ваша реклама</p>
									</div>
				    			`)
					    	}
				    	</script>
					</div>
	            </div>
          	</div>
	    </div>

	</div>

    <script>
	    $('#refresh-button').on('click', function(event) {
		    $.get("cache/invalidate")
		    	.done(function(data){
		    		location.reload();
			    })
				.fail(function(data) {
					console.log(data);
				});
		});
    </script>

    <script>
    	Bar.draw(planningInfo.platforms, planningInfo.maxStoryPoints, platform)
    	Chart.draw(planningInfo.platforms, planningInfo.maxStoryPoints, platform)
    </script>

{{ end }}
